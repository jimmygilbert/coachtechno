---
import { getCollection } from "astro:content";
import BlogPost from "../../layouts/BlogPost.astro";

const posts = (await getCollection("blog")).filter(p => !p.data.draft);

const tagCounts = new Map<string, number>();
for (const post of posts) {
  for (const t of post.data.tags ?? []) {
    const key = t.trim().toLowerCase();
    tagCounts.set(key, (tagCounts.get(key) ?? 0) + 1);
  }
}

const tags = [...tagCounts.entries()]
  .sort((a, b) => a[0].localeCompare(b[0]))
  .map(([tag, count]) => ({ tag, count }));
---

<BlogPost
  title="Tags"
  description="Liste de tous les tags du blog"
  pubDate={new Date()}
>
  <ul>
    {tags.map(({ tag, count }) => (
      <li>
        <a href={`/tags/${tag}/`}>{tag}</a> <small>({count})</small>
      </li>
    ))}
  </ul>
</BlogPost>
